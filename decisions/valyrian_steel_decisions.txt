# Targetted decisions are possible vs _all_ other characters and shown are in the Diplomacy View, not the Intrigue View. The taker is in the FROM scope.
#
# filter = [self/court/home_court/vassals/sub_realm/realm/dynasty/all] ('self' MUST be set for decisions targetting only the taker, the other filter types can be set to lessen CPU load)
# ai_target_filter = [self/court/home_court/vassals/sub_realm/realm/dynasty/all] (which characters for which the AI evaluates the decision.)
#	court: all characters in the AI's host court, including prisoners, and characters currently away (wards, prisoners, etc)
#	home_court: all characters in the AI's home court, including prisoners, and characters currently away (wards, prisoners, etc)
#	vassals: direct vassal rulers of the AI's employer
#	sub_realm: all characters below the AI's employer
#	realm: all characters in the same top realm as the AI
#	dynasty: all members of the same dynasty
#	all: all living characters (Avoid if possible. VERY CPU-HEAVY!)
#	

targetted_decisions = {
	give_blackfyre_to_son = {
		ai_target_filter = dynasty
		only_rulers = yes
		from_potential = {
			is_ruler = yes
			trait = blackfyre			
		}
		potential = {
			NOT = { trait = dragon }
			OR = {
				dynasty = FROM
				AND = {
					FROM = { NOT = { dynasty = 496 } }
					OR = {
						same_realm = FROM
						is_close_relative = FROM
					}
				}	
			}
			NOT = { character = FROM }
		}
		allow = {			
			FROM = { NOT = { trait = incapable } }
		}			
		effect = {
			FROM = { remove_trait = blackfyre hidden_tooltip = { character_event = { id = valyrian_steel.999 days = 1 } } }
			add_trait = blackfyre
			add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }
			if = {
				limit = { dynasty = FROM }
				if = {
					limit = {
						trait = bastard
						dynasty = 496
						NOR = {
							trait = eunuch
							trait = kingsguard
							trait = disinherited
							trait = nightswatch
							trait = salt_wife
							trait = dosh_khaleen
							trait = dragon
							trait = maester
							trait = archmaester
							trait = silent_sister
							trait = red_priest
							trait = drowned
							trait = grace
							trait = warlock
							trait = shadowbinder
							trait = bearded_priest
							trait = slave
							trait = septa
							trait = septon
							trait = ruin
							trait = cotf
							trait = courtesan
							trait = winter_wasteland
							trait = love_priest
							trait = horse
						}
					}
					remove_trait = bastard
					add_trait = legit_bastard
					dynasty=57
					if = {
						limit = {
							OR = {
								has_nickname = nick_snow
								has_nickname = nick_rivers
								has_nickname = nick_stone
								has_nickname = nick_hill
								has_nickname = nick_flowers
								has_nickname = nick_storm
								has_nickname = nick_waters
								has_nickname = nick_sand
								has_nickname = nick_pyke
							}
						}
						remove_nickname = yes
					}
				}
				opinion = {
					who = FROM
					modifier = opinion_gave_sword_to_me
					months = 360
				}
				FROM = {
					any_child = {
						limit = {
							OR = {
								is_primary_heir = yes
								AND = {
									martial = 10
									is_female = no
								}	
							}
							NOT = { character = ROOT }
						}
						opinion = {
							who = FROM
							modifier = opinion_didnt_give_sword_to_me
							months = 60
						}									
					}
				}
			}
			if = {
				limit = { NOT = { dynasty = FROM } }
				opinion = {
					who = FROM
					modifier = opinion_gave_sword_to_me
					months = 360
					multiplier = 2
				}
				FROM = {
					any_dynasty_member = {
						limit = {
							is_alive = yes
							is_close_relative = PREV
							NOT = { character = ROOT }
							NOT = { character = PREV }
						}
						opinion = {
							who = PREV
							modifier = opinion_didnt_give_sword_to_me
							months = 60
						}									
					}
				}	
			}
			hidden_tooltip = { 
				letter_event = { id = 250276 }
			}			
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { is_child_of = FROM }
			}
			modifier = {
				factor = 0
				FROM = { dynasty = 57 }
			}
			modifier = {
				factor = 0
				FROM = {
					dynasty = 496
					OR = {
						trait = honorable
						NOT = { trait = arbitrary }
						NOT = { trait = lunatic }
						ROOT = { NOT = { martial = 15 } }
					}	
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = { dynasty = 496 }
					NOT = {
						OR = {
							trait = dawn 
							trait = ice 
							trait = longclaw 
							trait = longclaw_snow 
							#trait = blackfyre 
							trait = brightroar
							trait = heartsbane 
							trait = nightfall
							trait = darksister
							trait = ladyforlorn
							trait = redrain
							trait = widowswail
							trait = oathkeeper
							trait = crabspincer
							trait = strangers_mercy
							trait = vigilance
							trait = orphan_maker
							trait = truth
							trait = lamentation
							trait = poison
						}
					}
				}	
			}
			modifier = {
				factor = 0.02 # Slow it down a bit
			}
			modifier = {
				factor = 2
				is_primary_heir = yes
			}
			modifier = {
				factor = 2.5
				is_female = no
			}
			modifier = {
				factor = 0.2
				trait = bastard
			}
			modifier = {
				factor = 1.5
				trait = trained_warrior
			}
			modifier = {
				factor = 2.5
				trait = skilled_warrior
			}
			modifier = {
				factor = 4
				trait = master_warrior
			}
		}
	}
	
	give_darksister_to_son = {
		ai_target_filter = dynasty
		only_rulers = yes
		from_potential = {
			is_ruler = yes
			trait = darksister
		}
		potential = {
			NOT = { trait = dragon }
			NOT = { culture_group = unoccupied_group } NOT = { culture_group = winter_group }
			
			OR = {
				dynasty = FROM
				AND = {
					FROM = { NOT = { dynasty = 496 } }
					OR = {
						same_realm = FROM
						is_close_relative = FROM
					}
				}	
			}	
			NOT = { character = FROM }			
		}
		allow = {
			
			FROM = { NOT = { trait = incapable } }
		}			
		effect = {
			FROM = { remove_trait = darksister hidden_tooltip = { character_event = { id = valyrian_steel.999 days = 1 } } }
			add_trait = darksister
			add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }
			if = {
				limit = { dynasty = FROM }
				opinion = {
					who = FROM
					modifier = opinion_gave_sword_to_me
					months = 360
				}
				if = {
					limit = { dynasty = 496 }#traditionally goes to targaryen warriors
					set_character_flag = given_darksister
					any_dynasty_member = {
						limit = {
							is_close_relative = FROM
							NOT = { character = ROOT }
							NOT = { character = FROM }
							OR = {
								trait = skilled_warrior
								trait = master_warrior
							}
						}
						opinion = {
							who = FROM
							modifier = opinion_didnt_give_sword_to_me
							months = 60
						}									
					}
				}	
				if = {
					limit = { NOT = { dynasty = 496 } }
					FROM = {
						any_child = {
							limit = {
								OR = {
									is_primary_heir = yes
									AND = {
										martial = 10
										is_female = no
									}	
								}
								NOT = { character = ROOT }
							}
							opinion = {
								who = FROM
								modifier = opinion_didnt_give_sword_to_me
								months = 60
							}									
						}
					}
				}
			}
			if = {
				limit = { NOT = { dynasty = FROM } }
				opinion = {
					who = FROM
					modifier = opinion_gave_sword_to_me
					months = 360
					multiplier = 2
				}
				FROM = {
					any_dynasty_member = {
						limit = {
							is_alive = yes
							is_close_relative = PREV
							NOT = { character = ROOT }
							NOT = { character = PREV }
						}
						opinion = {
							who = PREV
							modifier = opinion_didnt_give_sword_to_me
							months = 60
						}									
					}
				}	
			}	
			hidden_tooltip = { 
				letter_event = { id = 250276 }
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = { NOT = { dynasty = 496 } }
				NOT = { is_child_of = FROM }
			}
			modifier = { #targs will only give this to great warriors
				factor = 0
				FROM = { dynasty = 496 }
				OR = {
					NOT = { is_close_relative = FROM }
					NOT = {
						OR = {
							trait = skilled_warrior
							trait = master_warrior
						}
					}
					has_character_modifier = owns_valyrian_steel_sword
					FROM = {
						has_character_flag = given_darksister
						NOT = { trait = blackfyre }
						OR = {
							trait = skilled_warrior
							trait = master_warrior
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = {
						OR = {
							dynasty = 496 #targs will give this to great warriors
							trait = dawn 
							trait = ice 
							trait = longclaw 
							trait = longclaw_snow 
							trait = blackfyre 
							trait = brightroar
							trait = heartsbane 
							trait = nightfall
							trait = ladyforlorn
							trait = redrain
							#trait = darksister
							trait = widowswail
							trait = oathkeeper
							trait = crabspincer
							trait = strangers_mercy
							trait = vigilance
							trait = orphan_maker
							trait = truth
							trait = lamentation
							trait = poison
						}
					}
				}	
			}
			modifier = {
				factor = 0.02 # Slow it down a bit
			}
			modifier = {
				factor = 2
				is_primary_heir = yes
			}
			modifier = {
				factor = 2.5
				is_female = no
			}
			modifier = {
				factor = 0.2
				trait = bastard
			}
			modifier = {
				factor = 1.5
				trait = trained_warrior
			}
			modifier = {
				factor = 2.5
				trait = skilled_warrior
			}
			modifier = {
				factor = 4
				trait = master_warrior
			}
		}
	}
}
